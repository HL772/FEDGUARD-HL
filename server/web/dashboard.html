<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FedGuard 仪表盘</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="/static/dashboard.css?v=2" />
  </head>
  <body>
    <div class="page">
      <header class="header">
        <div class="header-content">
          <div class="brand">
            <div class="logo-icon">
              <i class="fa-solid fa-shield-halved"></i>
            </div>
            <div>
              <div style="display: flex; align-items: center; gap: 12px;">
                <h1>FedGuard-HL</h1>
                <div class="status-badge" style="padding: 4px 10px; height: 26px;">
                  <i class="fa-solid fa-circle" id="status-dot" style="font-size: 8px; color: #94a3b8; margin-right: 6px;"></i>
                  <span id="launch-status" style="font-weight: 600; font-size: 13px;">未启动</span>
                </div>
              </div>
              <p>联邦学习 · 隐私 · 通信 · 安全</p>
            </div>
          </div>
          <div class="header-actions">
            <div class="status-badge">
              <i class="fa-solid fa-circle-notch fa-spin" id="spinner" style="display:none; margin-right:6px"></i>
              <span>轮次 <strong id="round-id">-</strong></span>
            </div>
            <div class="status-badge">
              <i class="fa-solid fa-users"></i>
              <span>客户端 <strong id="clients-count">0</strong></span>
            </div>
            <button id="help-btn" class="icon-btn" type="button" aria-label="帮助">
              <i class="fa-regular fa-circle-question"></i>
            </button>
          </div>
        </div>
      </header>

      <div class="summary-grid">
        <div class="summary-card">
          <div class="icon-wrapper"><i class="fa-solid fa-arrows-spin"></i></div>
          <div class="summary-content">
            <span class="label">当前轮次</span>
            <span class="value" id="summary-round">-</span>
          </div>
        </div>
        <div class="summary-card">
          <div class="icon-wrapper"><i class="fa-solid fa-users-viewfinder"></i></div>
          <div class="summary-content">
            <span class="label">参与 / 总数</span>
            <span class="value" id="summary-participants">-</span>
          </div>
        </div>
        <div class="summary-card">
          <div class="icon-wrapper"><i class="fa-regular fa-clock"></i></div>
          <div class="summary-content">
            <span class="label">轮次耗时</span>
            <span class="value" id="summary-round-time">-</span>
          </div>
        </div>
        <div class="summary-card">
          <div class="icon-wrapper"><i class="fa-solid fa-user-shield"></i></div>
          <div class="summary-content">
            <span class="label">DP 模式</span>
            <span class="value" id="summary-dp">-</span>
          </div>
        </div>
        <div class="summary-card">
          <div class="icon-wrapper"><i class="fa-solid fa-cubes-stacked"></i></div>
          <div class="summary-content">
            <span class="label">聚合算法</span>
            <span class="value" id="summary-agg">-</span>
          </div>
        </div>
        <div class="summary-card">
          <div class="icon-wrapper"><i class="fa-solid fa-filter"></i></div>
          <div class="summary-content">
            <span class="label">采样策略</span>
            <span class="value" id="summary-sampling">-</span>
          </div>
        </div>
        <div class="summary-card">
          <div class="icon-wrapper"><i class="fa-solid fa-mask"></i></div>
          <div class="summary-content">
            <span class="label">ε 最大值</span>
            <span class="value" id="summary-epsilon">-</span>
          </div>
        </div>
        <div class="summary-card">
          <div class="icon-wrapper"><i class="fa-solid fa-cloud-arrow-up"></i></div>
          <div class="summary-content">
            <span class="label">上传总量</span>
            <span class="value" id="summary-upload">-</span>
          </div>
        </div>
        <div class="summary-card">
          <div class="icon-wrapper"><i class="fa-solid fa-file-zipper"></i></div>
          <div class="summary-content">
            <span class="label">压缩比</span>
            <span class="value" id="summary-compress">-</span>
          </div>
        </div>
        <div class="summary-card">
          <div class="icon-wrapper"><i class="fa-solid fa-ban"></i></div>
          <div class="summary-content">
            <span class="label">拉黑数</span>
            <span class="value" id="summary-excluded">-</span>
          </div>
        </div>
        <div class="summary-card">
          <div class="icon-wrapper"><i class="fa-solid fa-hourglass-end"></i></div>
          <div class="summary-content">
            <span class="label">超时数</span>
            <span class="value" id="summary-timeout">-</span>
          </div>
        </div>
      </div>

      <nav class="tabs-nav">
        <button class="tab active" data-target="launch-panel">
          <i class="fa-solid fa-rocket"></i> 启动配置
        </button>
        <button class="tab" data-target="client-panel">
          <i class="fa-solid fa-chart-line"></i> 客户端指标
        </button>
        <button class="tab" data-target="client-manage-panel">
          <i class="fa-solid fa-users-gear"></i> 客户端管理
        </button>
        <button class="tab" data-target="server-panel">
          <i class="fa-solid fa-server"></i> 服务端聚合
        </button>
      </nav>

      <main>
        <section id="client-panel" class="panel">
          <!-- 客户端训练与通信指标 -->
          <div class="grid">
            <div class="card chart-card">
              <div class="card-header-simple">
                <h3><i class="fa-solid fa-arrow-trend-down"></i> 损失曲线</h3>
              </div>
              <canvas id="loss-chart"></canvas>
            </div>
            <div class="card chart-card">
              <div class="card-header-simple">
                <h3><i class="fa-solid fa-bullseye"></i> 准确率曲线</h3>
              </div>
              <canvas id="acc-chart"></canvas>
            </div>
            <div class="card chart-card">
              <div class="card-header-simple">
                <h3><i class="fa-solid fa-shield-cat"></i> 隐私预算 ε</h3>
              </div>
              <canvas id="epsilon-chart"></canvas>
            </div>
            <div class="card chart-card">
              <div class="card-header-simple">
                <h3><i class="fa-solid fa-sliders"></i> 噪声 / 裁剪率</h3>
              </div>
              <canvas id="dp-control-chart"></canvas>
            </div>
            <div class="card chart-card">
              <div class="card-header-simple">
                <h3><i class="fa-solid fa-network-wired"></i> 通信负载</h3>
              </div>
              <canvas id="comm-chart"></canvas>
            </div>
          </div>

          <div class="card full-width">
            <div class="card-header">
              <h2><i class="fa-solid fa-list-ul"></i> 客户端更新详情</h2>
              <div class="pager">
                <button id="client-updates-prev" type="button" class="pager-btn" aria-label="上一轮">
                  <i class="fa-solid fa-chevron-left"></i>
                </button>
                <span id="client-updates-label" class="pager-label">轮次 -</span>
                <button id="client-updates-next" type="button" class="pager-btn" aria-label="下一轮">
                  <i class="fa-solid fa-chevron-right"></i>
                </button>
              </div>
            </div>
            <div class="table-container">
              <table class="alert-table">
                <thead>
                  <tr>
                    <th>客户端</th>
                    <th>状态</th>
                    <th>损失</th>
                    <th>准确率</th>
                    <th>ε</th>
                    <th>上传 KB</th>
                    <th>标签分布</th>
                  </tr>
                </thead>
                <tbody id="client-update-body"></tbody>
              </table>
            </div>
          </div>
        </section>

        <section id="client-manage-panel" class="panel">
          <div class="grid-manage">
            <div class="card online-card">
              <div class="card-header-simple">
                <h3><i class="fa-solid fa-wifi"></i> 在线客户端</h3>
              </div>
              <ul id="client-list" class="client-list compact"></ul>
            </div>

            <div class="card">
              <div class="card-header">
                <h2><i class="fa-solid fa-user-lock"></i> 操作管理</h2>
              </div>
              <div class="table-container">
                <table class="alert-table">
                  <thead>
                    <tr>
                      <th>客户端</th>
                      <th>状态</th>
                      <th>操作</th>
                    </tr>
                  </thead>
                  <tbody id="client-manage-body"></tbody>
                </table>
              </div>
            </div>
          </div>

          <div class="card mt-4">
            <div class="card-header-simple">
              <h3><i class="fa-solid fa-triangle-exclamation"></i> 系统告警与日志</h3>
            </div>
            <div class="table-container">
              <table class="alert-table">
                <thead>
                  <tr>
                    <th>轮次</th>
                    <th>时间</th>
                    <th>客户端</th>
                    <th>原因</th>
                    <th>动作</th>
                  </tr>
                </thead>
                <tbody id="alert-body"></tbody>
              </table>
            </div>
          </div>
        </section>

        <section id="launch-panel" class="panel active">
          <!-- 启动配置与参数选择 -->
          <div class="launch-controls-wrapper">
            <div class="card launch-status-card">
              <div class="card-header" style="margin-bottom:0; border-bottom:none; padding-bottom:0;">
                <h2><i class="fa-solid fa-power-off"></i> 启动控制</h2>
                <div class="launch-actions">
                  <button id="launch-start" type="button" class="btn btn-primary"><i class="fa-solid fa-play"></i> 启动</button>
                  <button id="launch-stop" type="button" class="btn btn-danger"><i class="fa-solid fa-stop"></i> 停止</button>
                </div>
              </div>
            </div>

            <div class="config-grid">
              <div class="card">
                <h3><i class="fa-solid fa-layer-group"></i> 运行规模</h3>
                <div class="form-grid">
                  <div class="form-field">
                    <label for="launch-num-clients">
                      客户端数量
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="联邦学习系统中的模拟客户端总数。"></i>
                    </label>
                    <input id="launch-num-clients" type="number" min="1" value="14" />
                  </div>
                  <div class="form-field">
                    <label for="launch-clients-per-round">
                      每轮参与数
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="每轮训练中随机选择或采样参与聚合的客户端数量。"></i>
                    </label>
                    <input id="launch-clients-per-round" type="number" min="1" value="8" />
                  </div>
                  <div class="form-field">
                    <label for="launch-client-batch">
                      并发批次
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="控制服务端同时启动的客户端进程数量（并发度）。"></i>
                    </label>
                    <input id="launch-client-batch" type="number" min="1" value="14" />
                  </div>
                  <div class="form-field">
                    <label for="launch-max-rounds">
                      最大轮数
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="联邦学习训练的总迭代轮次。"></i>
                    </label>
                    <input id="launch-max-rounds" type="number" min="1" value="20" />
                  </div>
                  <div class="form-field">
                    <label for="launch-online-ttl">
                      在线 TTL（秒）
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="客户端在无心跳情况下保持在线状态的最长时间。"></i>
                    </label>
                    <input id="launch-online-ttl" type="number" min="1" value="600" />
                  </div>
                  <div class="form-field form-toggle">
                    <label class="toggle-label">
                      <input id="launch-download-data" type="checkbox" />
                      <span class="toggle-text">下载数据</span>
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="启动时是否强制重新下载/准备数据集。"></i>
                    </label>
                  </div>
                  <div class="form-field form-toggle">
                    <label class="toggle-label">
                      <input id="launch-stay-online" type="checkbox" />
                      <span class="toggle-text">未入选保持在线</span>
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="客户端本轮若未被选中参与训练，是否继续保持进程运行。"></i>
                    </label>
                  </div>
                </div>
              </div>

              <div class="card">
                <h3><i class="fa-solid fa-brain"></i> 训练参数</h3>
                <div class="form-grid">
                  <div class="form-field">
                    <label for="launch-train-algo">
                      训练算法
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="选择联邦学习聚合算法：FedAvg (基础), FedProx (处理异构性), FedPer (个性化)。"></i>
                    </label>
                    <div class="select-wrapper">
                      <select id="launch-train-algo">
                        <option value="fedavg">fedavg</option>
                        <option value="fedprox">fedprox</option>
                        <option value="fedper">fedper</option>
                        <option value="fedper_dual">fedper_dual</option>
                      </select>
                    </div>
                  </div>
                  <div class="form-field">
                    <label for="launch-train-lr">
                      学习率
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="客户端本地训练的梯度下降步长。"></i>
                    </label>
                    <input id="launch-train-lr" type="number" step="0.0001" />
                  </div>
                  <div class="form-field">
                    <label for="launch-train-epochs">
                      本地轮数
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="每轮联邦学习中，客户端在本地数据上训练的迭代次数。"></i>
                    </label>
                    <input id="launch-train-epochs" type="number" min="1" />
                  </div>
                  <div class="form-field">
                    <label for="launch-fedprox-mu">
                      FedProx μ
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="FedProx 算法的近端项系数，用于限制本地更新偏离全局模型。"></i>
                    </label>
                    <input id="launch-fedprox-mu" type="number" step="0.0001" />
                  </div>
                  <div class="form-field">
                    <label for="launch-deadline-ms">
                      超时阈值(ms)
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="服务端等待客户端返回更新的最长时间，超过则视为超时。"></i>
                    </label>
                    <input id="launch-deadline-ms" type="number" min="0" />
                  </div>
                  <div class="form-field">
                    <label for="launch-server-lr">
                      服务端学习率
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="服务端在应用聚合梯度时的步长（通常为 1.0）。"></i>
                    </label>
                    <input id="launch-server-lr" type="number" step="0.0001" />
                  </div>
                  <div class="form-field">
                    <label for="launch-server-clip">
                      服务端裁剪阈值
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="服务端对聚合后的全局更新进行范数裁剪的阈值。"></i>
                    </label>
                    <input id="launch-server-clip" type="number" step="0.1" />
                  </div>
                  <div class="form-field">
                    <label for="launch-private-head-lr">
                      私有 Head LR
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="个性化层（Private Head）的学习率。"></i>
                    </label>
                    <input id="launch-private-head-lr" type="number" step="0.0001" />
                  </div>
                  <div class="form-field">
                    <label for="launch-private-head-epochs">
                      私有 Head 轮数
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="个性化层在本地训练中的迭代次数。"></i>
                    </label>
                    <input id="launch-private-head-epochs" type="number" min="1" />
                  </div>
                </div>
              </div>

              <div class="card">
                <h3><i class="fa-solid fa-database"></i> 数据与采样</h3>
                <div class="form-grid">
                  <div class="form-field">
                    <label for="launch-data-alpha">
                      Dirichlet α
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="控制非 IID 程度。值越小，客户端间数据分布差异越大（异构性越高）。"></i>
                    </label>
                    <input id="launch-data-alpha" type="number" step="0.01" />
                  </div>
                  <div class="form-field form-toggle">
                    <label class="toggle-label">
                      <input id="launch-sampling-enabled" type="checkbox" />
                      <span class="toggle-text">启用采样</span>
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="是否使用智能采样策略（如基于评分）代替随机选择。"></i>
                    </label>
                  </div>
                  <div class="form-field">
                    <label for="launch-sampling-strategy">
                      采样策略
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="采样算法：random (随机), score (基于性能和公平性评分)。"></i>
                    </label>
                    <div class="select-wrapper">
                      <select id="launch-sampling-strategy">
                        <option value="random">random</option>
                        <option value="score">score</option>
                      </select>
                    </div>
                  </div>
                  <div class="form-field">
                    <label for="launch-sampling-epsilon">
                      采样 ε
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="采样策略中的探索因子，用于平衡性能优选与随机探索。"></i>
                    </label>
                    <input id="launch-sampling-epsilon" type="number" step="0.01" />
                  </div>
                  <div class="form-field">
                    <label for="launch-sampling-ema">
                      评分 EMA
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="客户端历史表现评分的指数移动平均系数。"></i>
                    </label>
                    <input id="launch-sampling-ema" type="number" step="0.01" />
                  </div>
                  <div class="form-field">
                    <label for="launch-sampling-timeout-penalty">
                      超时惩罚
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="客户端发生超时时，对其采样评分的扣分权重。"></i>
                    </label>
                    <input id="launch-sampling-timeout-penalty" type="number" step="0.1" />
                  </div>
                  <div class="form-field">
                    <label for="launch-sampling-anomaly-penalty">
                      异常惩罚
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="客户端被检测为恶意/异常时，对其采样评分的扣分权重。"></i>
                    </label>
                    <input id="launch-sampling-anomaly-penalty" type="number" step="0.1" />
                  </div>
                  <div class="form-field">
                    <label for="launch-sampling-fairness">
                      公平窗口
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="计算公平性得分时考虑的历史轮次范围。"></i>
                    </label>
                    <input id="launch-sampling-fairness" type="number" min="0" />
                  </div>
                  <div class="form-field">
                    <label for="launch-sampling-softmax">
                      Softmax 温度
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="控制采样概率分布的平滑程度。"></i>
                    </label>
                    <input id="launch-sampling-softmax" type="number" step="0.1" />
                  </div>
                </div>
              </div>

              <div class="card">
                <h3><i class="fa-solid fa-user-secret"></i> 差分隐私</h3>
                <div class="form-grid">
                  <div class="form-field form-toggle">
                    <label class="toggle-label">
                      <input id="launch-dp-enabled" type="checkbox" />
                      <span class="toggle-text">启用 DP</span>
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="是否启用差分隐私保护，对梯度进行裁剪并添加噪声。"></i>
                    </label>
                  </div>
                  <div class="form-field">
                    <label for="launch-dp-mode">
                      DP 模式
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="DP 算法模式：adaptive_rdp (自适应), static (静态)。"></i>
                    </label>
                    <div class="select-wrapper">
                      <select id="launch-dp-mode">
                        <option value="adaptive_rdp">adaptive_rdp</option>
                        <option value="static">static</option>
                        <option value="off">off</option>
                      </select>
                    </div>
                  </div>
                  <div class="form-field">
                    <label for="launch-dp-clip">
                      裁剪阈值
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="梯度裁剪的范数上限，用于限制单个样本对模型的影响。"></i>
                    </label>
                    <input id="launch-dp-clip" type="number" step="0.1" />
                  </div>
                  <div class="form-field">
                    <label for="launch-dp-noise">
                      噪声乘子
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="注入噪声的标准差系数。值越大，隐私保护越强，但精度下降越多。"></i>
                    </label>
                    <input id="launch-dp-noise" type="number" step="0.01" />
                  </div>
                  <div class="form-field">
                    <label for="launch-dp-delta">
                      δ
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="差分隐私中的失效概率阈值，通常设为小于客户端数量倒数的小值。"></i>
                    </label>
                    <input id="launch-dp-delta" type="number" step="0.000001" />
                  </div>
                  <div class="form-field">
                    <label for="launch-dp-target">
                      目标 ε
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="期望达到的总隐私预算消耗目标。"></i>
                    </label>
                    <input id="launch-dp-target" type="number" step="0.1" />
                  </div>
                  <div class="form-field">
                    <label for="launch-dp-schedule">
                      噪声衰减
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="噪声乘子随轮次变化的调度策略。"></i>
                    </label>
                    <div class="select-wrapper">
                      <select id="launch-dp-schedule">
                        <option value="">无</option>
                        <option value="linear">linear</option>
                        <option value="exp">exp</option>
                        <option value="cosine_decay">cosine_decay</option>
                      </select>
                    </div>
                  </div>
                  <div class="form-field">
                    <label for="launch-dp-sigma-ratio">
                      衰减比例
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="噪声调度结束时的最终噪声比例。"></i>
                    </label>
                    <input id="launch-dp-sigma-ratio" type="number" step="0.01" />
                  </div>
                  <div class="form-field form-toggle">
                    <label class="toggle-label">
                      <input id="launch-dp-adaptive" type="checkbox" />
                      <span class="toggle-text">自适应裁剪</span>
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="是否根据梯度分布动态调整裁剪阈值。"></i>
                    </label>
                  </div>
                  <div class="form-field">
                    <label for="launch-dp-percentile">
                      裁剪分位
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="自适应裁剪时参考的梯度范数分位数。"></i>
                    </label>
                    <input id="launch-dp-percentile" type="number" step="0.01" />
                  </div>
                  <div class="form-field">
                    <label for="launch-dp-ema">
                      裁剪 EMA
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="自适应裁剪阈值更新的平滑系数。"></i>
                    </label>
                    <input id="launch-dp-ema" type="number" step="0.01" />
                  </div>
                </div>
              </div>

              <div class="card">
                <h3><i class="fa-solid fa-compress"></i> 模型压缩</h3>
                <div class="form-grid">
                  <div class="form-field form-toggle">
                    <label class="toggle-label">
                      <input id="launch-compression-enabled" type="checkbox" />
                      <span class="toggle-text">启用压缩</span>
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="是否启用梯度压缩以减少通信开销。"></i>
                    </label>
                  </div>
                  <div class="form-field">
                    <label for="launch-topk-ratio">
                      Top-K 比例
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="稀疏化比例：仅上传数值最大的前 K% 梯度。"></i>
                    </label>
                    <input id="launch-topk-ratio" type="number" step="0.01" />
                  </div>
                  <div class="form-field">
                    <label for="launch-quant-bits">
                      量化位数
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="将 32 位浮点数映射为更低位宽的整数（如 8 位或 16 位）。"></i>
                    </label>
                    <div class="select-wrapper">
                      <select id="launch-quant-bits">
                        <option value="8">8</option>
                        <option value="16">16</option>
                      </select>
                    </div>
                  </div>
                  <div class="form-field form-toggle">
                    <label class="toggle-label">
                      <input id="launch-error-feedback" type="checkbox" />
                      <span class="toggle-text">误差反馈</span>
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="将本轮压缩损失的误差累积到下一轮梯度中，提高收敛性。"></i>
                    </label>
                  </div>
                </div>
              </div>

              <div class="card">
                <h3><i class="fa-solid fa-shield-virus"></i> 安全与检测</h3>
                <div class="form-grid">
                  <div class="form-field form-toggle">
                    <label class="toggle-label">
                      <input id="launch-secure-agg" type="checkbox" />
                      <span class="toggle-text">安全聚合</span>
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="使用加法同态掩码保护客户端明文梯度，服务端仅能看到聚合结果。"></i>
                    </label>
                  </div>
                  <div class="form-field form-toggle">
                    <label class="toggle-label">
                      <input id="launch-malicious-detect" type="checkbox" />
                      <span class="toggle-text">恶意检测</span>
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="自动识别并剔除提交异常梯度（如损失过大或更新范数异常）的客户端。"></i>
                    </label>
                  </div>
                  <div class="form-field">
                    <label for="launch-robust-method">
                      鲁棒聚合
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="拜占庭容错聚合算法：Trimmed Mean, Median, Krum (抗攻击能力强)。"></i>
                    </label>
                    <div class="select-wrapper">
                      <select id="launch-robust-method">
                        <option value="fedavg">fedavg</option>
                        <option value="trimmed_mean">trimmed_mean</option>
                        <option value="median">median</option>
                        <option value="krum">krum</option>
                        <option value="bulyan">bulyan</option>
                      </select>
                    </div>
                  </div>
                  <div class="form-field">
                    <label for="launch-trim-ratio">
                      Trim 比例
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="Trimmed Mean 算法中两端剔除的最大/最小值比例。"></i>
                    </label>
                    <input id="launch-trim-ratio" type="number" step="0.01" />
                  </div>
                  <div class="form-field">
                    <label for="launch-byzantine-f">
                      Byzantine f
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="算法假设的最大恶意客户端数量。"></i>
                    </label>
                    <input id="launch-byzantine-f" type="number" min="0" />
                  </div>
                  <div class="form-field">
                    <label for="launch-loss-threshold">
                      Loss 阈值
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="恶意检测中允许的本地损失偏离中位数的最大 MAD 倍数。"></i>
                    </label>
                    <input id="launch-loss-threshold" type="number" step="0.1" />
                  </div>
                  <div class="form-field">
                    <label for="launch-norm-threshold">
                      Norm 阈值
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="恶意检测中允许的梯度范数偏离中位数的最大 MAD 倍数。"></i>
                    </label>
                    <input id="launch-norm-threshold" type="number" step="0.1" />
                  </div>
                  <div class="form-field form-toggle">
                    <label class="toggle-label">
                      <input id="launch-require-both" type="checkbox" />
                      <span class="toggle-text">需同时异常</span>
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="仅在 Loss 和 Norm 同时超过阈值时才判定为恶意。"></i>
                    </label>
                  </div>
                  <div class="form-field">
                    <label for="launch-min-mad">
                      最小 MAD
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="中位数绝对偏差的最小保护值，防止分布过于集中导致误判。"></i>
                    </label>
                    <input id="launch-min-mad" type="number" step="0.01" />
                  </div>
                  <div class="form-field form-toggle">
                    <label class="toggle-label">
                      <input id="launch-cosine-enabled" type="checkbox" />
                      <span class="toggle-text">余弦检测</span>
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="通过计算更新方向与参考方向的余弦相似度来检测攻击。"></i>
                    </label>
                  </div>
                  <div class="form-field">
                    <label for="launch-cosine-threshold">
                      余弦阈值
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="判定为恶意的余弦相似度 z-score 阈值。"></i>
                    </label>
                    <input id="launch-cosine-threshold" type="number" step="0.1" />
                  </div>
                  <div class="form-field">
                    <label for="launch-cosine-topk">
                      余弦 Top-K
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="计算相似度时仅考虑的前 K 个最具代表性的梯度分量。"></i>
                    </label>
                    <input id="launch-cosine-topk" type="number" min="0" />
                  </div>
                </div>
              </div>

              <div class="card">
                <h3><i class="fa-solid fa-bug"></i> 攻击模拟</h3>
                <div class="form-grid">
                  <div class="form-field form-toggle">
                    <label class="toggle-label">
                      <input id="launch-attack-enabled" type="checkbox" />
                      <span class="toggle-text">启用攻击</span>
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="是否在训练中模拟恶意攻击行为。"></i>
                    </label>
                  </div>
                  <div class="form-field">
                    <label for="launch-attack-method">
                      攻击方式
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="攻击类型：scale (放大更新), sign_flip (符号翻转), label_flip (标签翻转)。"></i>
                    </label>
                    <div class="select-wrapper">
                      <select id="launch-attack-method">
                        <option value="scale">scale</option>
                        <option value="sign_flip">sign_flip</option>
                        <option value="label_flip">label_flip</option>
                      </select>
                    </div>
                  </div>
                  <div class="form-field">
                    <label for="launch-attack-scale">
                      攻击比例
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="Scale 攻击中的放大倍数。"></i>
                    </label>
                    <input id="launch-attack-scale" type="number" step="0.1" />
                  </div>
                  <div class="form-field">
                    <label for="launch-attack-fraction">
                      恶意比例
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="系统中恶意客户端占参与者的百分比。"></i>
                    </label>
                    <input id="launch-attack-fraction" type="number" step="0.01" />
                  </div>
                  <div class="form-field">
                    <label for="launch-attack-ranks">
                      恶意 ranks
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="指定特定 rank 的客户端执行攻击（如 0,1）。"></i>
                    </label>
                    <input id="launch-attack-ranks" type="text" placeholder="0,1" />
                  </div>
                  <div class="form-field form-toggle">
                    <label class="toggle-label">
                      <input id="launch-attack-label-flip" type="checkbox" />
                      <span class="toggle-text">标签翻转</span>
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="模拟客户端将数据标签篡改（如 3 换成 8）的数据毒害攻击。"></i>
                    </label>
                  </div>
                  <div class="form-field">
                    <label for="launch-attack-loss-scale">
                      损失放大
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="模拟恶意客户端伪造极高训练损失的行为。"></i>
                    </label>
                    <input id="launch-attack-loss-scale" type="number" step="0.1" />
                  </div>
                  <div class="form-field">
                    <label for="launch-attack-acc-scale">
                      准确率缩放
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="模拟恶意客户端汇报极低准确率的行为。"></i>
                    </label>
                    <input id="launch-attack-acc-scale" type="number" step="0.1" />
                  </div>
                </div>
              </div>

              <div class="card">
                <h3><i class="fa-solid fa-hourglass-half"></i> 超时模拟</h3>
                <div class="form-grid">
                  <div class="form-field form-toggle">
                    <label class="toggle-label">
                      <input id="launch-timeout-enabled" type="checkbox" />
                      <span class="toggle-text">启用超时模拟</span>
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="模拟网络不稳定或客户端掉线的超时情况。"></i>
                    </label>
                  </div>
                  <div class="form-field">
                    <label for="launch-timeout-ranks">
                      客户端 ranks
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="指定特定 rank 的客户端模拟超时（如 0,2）。"></i>
                    </label>
                    <input
                      id="launch-timeout-ranks"
                      type="text"
                      placeholder="例如 0,2"
                    />
                  </div>
                  <div class="form-field">
                    <label for="launch-timeout-cooldown">
                      冷却轮数
                      <i class="fa-solid fa-circle-info tooltip-icon" data-tooltip="超时客户端在重新进入系统前需要等待的轮次。"></i>
                    </label>
                    <input id="launch-timeout-cooldown" type="number" min="0" />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section id="server-panel" class="panel">
          <!-- 服务端评估与安全检测摘要 -->
          <div class="grid">
            <div class="card chart-card">
              <div class="card-header-simple">
                <h3><i class="fa-solid fa-chart-area"></i> 服务端评估损失</h3>
              </div>
              <canvas id="server-loss-chart"></canvas>
            </div>
            <div class="card chart-card">
              <div class="card-header-simple">
                <h3><i class="fa-solid fa-chart-line"></i> 服务端评估准确率</h3>
              </div>
              <canvas id="server-acc-chart"></canvas>
            </div>
            <div class="card chart-card">
              <div class="card-header-simple">
                <h3><i class="fa-solid fa-ruler-vertical"></i> 聚合更新范数</h3>
              </div>
              <canvas id="server-update-chart"></canvas>
            </div>
            <div class="card chart-card">
              <div class="card-header-simple">
                <h3><i class="fa-solid fa-scale-balanced"></i> 个体准确率公平性</h3>
              </div>
              <canvas id="fairness-chart"></canvas>
            </div>
            <div class="card">
              <div class="card-header-simple">
                <h3><i class="fa-solid fa-clipboard-check"></i> 服务端摘要</h3>
              </div>
              <ul id="server-summary" class="client-list"></ul>
            </div>
            <div class="card">
              <div class="card-header-simple">
                <h3><i class="fa-solid fa-magnifying-glass-chart"></i> 检测摘要</h3>
              </div>
              <ul id="security-summary" class="client-list"></ul>
            </div>
            <div class="card">
              <div class="card-header-simple">
                <h3><i class="fa-solid fa-ranking-star"></i> 相似度排名</h3>
              </div>
              <ul id="similarity-rank" class="client-list"></ul>
            </div>
          </div>
        </section>
      </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/static/dashboard.js"></script>

    <div
      id="help-modal"
      class="modal hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="help-title"
      aria-hidden="true"
      hidden
    >
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="help-title"><i class="fa-regular fa-circle-question"></i> 指标说明</h2>
          <button id="help-close" class="modal-close" type="button"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="modal-body">
          <h3>启动配置</h3>
          <ul class="modal-list">
            <li><strong>客户端数量 / 每轮参与 / 并发批次</strong>：本次训练的客户端规模与并发启动方式。</li>
            <li><strong>最大轮数</strong>：训练的轮次上限。</li>
            <li><strong>在线 TTL</strong>：多长时间未收到心跳/请求则判为离线。</li>
            <li><strong>差分隐私 / 压缩 / 安全</strong>：对应 DP、压缩、安全聚合、鲁棒聚合等开关与参数。</li>
          </ul>

          <h3>客户端指标</h3>
          <ul class="modal-list">
            <li><strong>损失曲线</strong>：每轮客户端训练损失的加权均值。</li>
            <li><strong>准确率曲线</strong>：每轮客户端训练准确率的加权均值。</li>
            <li><strong>隐私预算 ε</strong>：每轮客户端隐私消耗的最大值/均值，以及隐私会计累计值。</li>
            <li><strong>噪声 / 裁剪率</strong>：DP 噪声乘子与梯度裁剪比例。</li>
            <li><strong>通信负载</strong>：本轮上传 KB 与压缩比。</li>
          </ul>

          <h3>服务端聚合</h3>
          <ul class="modal-list">
            <li><strong>服务端评估损失/准确率</strong>：聚合后的全局模型在验证集上的表现。</li>
            <li><strong>聚合更新范数</strong>：本轮聚合更新的向量范数。</li>
            <li><strong>个体准确率公平性</strong>：参与客户端的准确率均值、最小值、标准差与 Jain 指数。</li>
          </ul>

          <h3>概览卡片</h3>
          <ul class="modal-list">
            <li><strong>K / N</strong>：本轮参与聚合的客户端数 / 在线可选客户端数。</li>
            <li><strong>轮次耗时</strong>：本轮端到端耗时（毫秒）。</li>
            <li><strong>DP 模式</strong>：当前差分隐私模式（关闭或具体模式）。</li>
            <li><strong>聚合</strong>：服务端聚合算法类型。</li>
            <li><strong>采样</strong>：客户端选择策略与模式。</li>
            <li><strong>ε 最大值</strong>：本轮客户端隐私消耗最大值。</li>
            <li><strong>上传总量</strong>：本轮客户端上传数据总 KB。</li>
            <li><strong>压缩比</strong>：压缩前后字节比值。</li>
            <li><strong>拉黑数</strong>：已被检测并拉黑的客户端数量。</li>
            <li><strong>超时数</strong>：本轮超时客户端数量。</li>
          </ul>

          <h3>列表与告警</h3>
          <ul class="modal-list">
            <li><strong>在线客户端</strong>：当前在线与已拉黑状态。</li>
            <li><strong>客户端更新</strong>：每轮客户端的损失、准确率、隐私 ε、上传量与标签分布。</li>
            <li><strong>客户端管理</strong>：手动拉黑或解除在线客户端。</li>
            <li><strong>检测摘要</strong>：恶意检测精确率/召回率/F1 与阈值。</li>
            <li><strong>相似度排名</strong>：客户端更新与参考方向的相似度 z 分数排名。</li>
            <li><strong>告警日志</strong>：异常原因与处置记录。</li>
          </ul>
        </div>
      </div>
    </div>
  </body>
</html>
